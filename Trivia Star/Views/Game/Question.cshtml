@model Trivia_Star.Models.QuestionModel

@{
    ViewData["Title"] = "Question";
}

@section Styles {
    <link rel="stylesheet" href="~/css/Question.css">
}

@section Scripts {
    @if (!Model.AnswerSubmitted)
    {
        <script src="~/js/Question.js" defer></script>
    }
}

@{
    var categoryId = Context.Session.GetInt32("CategoryId") ?? 0;
}

@functions {

    string GetAccentClass(int categoryId) => categoryId switch
    {

        22 => "geo-accent",
        23 => "his-accent",
        25 => "art-accent",
        11 => "ent-accent",
        21 => "spo-accent",
        17 => "sci-accent",
        _ => "default-theme"

    };
    
    string GetBoxClass(int categoryId) => categoryId switch
    {

        22 => "geo-box",
        23 => "his-box",
        25 => "art-box",
        11 => "ent-box",
        21 => "spo-box",
        17 => "sci-box",
        _ => "default-theme"

    };

}

<div class="container">
    <div class="layout-row">
        <div class="timer-box @GetBoxClass(categoryId)">
            <header class="header time-header @GetAccentClass(categoryId)">
                Time
            </header>
            <div class="timer-text" id="timer" data-initial-time="@Model.RemainingTime" 
                 data-answer-submitted="@Model.AnswerSubmitted.ToString().ToLower()">
                @Model.RemainingTime
            </div>
        </div>
        
        <div class="main-column">
            <div class="question-box @GetBoxClass(categoryId)">
                <header class="header @GetAccentClass(categoryId)">
                    Question @(Model.QuestionIndex + 1)
                </header>

                <div class="question-text">
                    @Html.Raw(Model.Question)
                </div>

                @if (Model.AnswerSubmitted)
                {
                    <form method="post" asp-action="NextQuestion">
                        <button class="next-button @GetAccentClass(categoryId)">Next</button>
                    </form>
                }
            </div>

            <div class="answers-box">
                 @foreach (var answer in Model.ShuffledAnswers)
                 {
                      var buttonClass = GetAccentClass(categoryId);

                      if (Model.AnswerSubmitted)
                      {
                         if (answer == Model.CorrectAnswer)
                         {
                            buttonClass += " correct";
                         }
                         else if (answer == Model.UserSelectedAnswer)
                         {
                            buttonClass += " incorrect";
                         }
                         else
                         {
                            buttonClass += " faded";
                         }
                      }

                      <form method="post" asp-action="SubmitAnswer">
                          <input type="hidden" name="selectedAnswer" value="@answer"/>
                          <input type="hidden" name="remainingTime" />
                         <button type="submit" class="@buttonClass" @(Model.AnswerSubmitted ? "disabled" : "")>
                            @Html.Raw(answer)
                         </button>
                     </form>
                 }
            </div>  
        </div>
    </div>
</div>